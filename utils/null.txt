
Extra code to debug app.py

# --- MULTI-MODEL DEBUG BLOCK ---
if st.sidebar.button("ðŸ”Ž DEBUG: Multi-model Gemini Test"):
    import google.generativeai as genai
    import time

    key = (
        os.getenv("GEMINI_API_KEY")
        or st.secrets.get("GEMINI_API_KEY")
        or st.secrets.get("GOOGLE_API_KEY")
    )
    st.write("Key present in env/secrets:", bool(key))
    if not key:
        st.error("No GEMINI_API_KEY found.")
        st.stop()

    genai.configure(api_key=key)

    models_to_try = [
        "models/gemini-2.5-pro",
        "models/gemini-1.5-pro",
        "models/gemini-2.5-flash",
        "models/gemini-1.5-flash",
        "models/gemini-1.5-pro-latest",
    ]

    results = []
    for mname in models_to_try:
        st.write("----")
        st.write("Trying model:", mname)
        try:
            model = genai.GenerativeModel(mname)
            resp = model.generate_content("Say hello in one short sentence.")

            text = getattr(resp, "text", None)

            cand_dump = []
            for c in getattr(resp, "candidates", []):
                parts = []
                for p in getattr(getattr(c, "content", None), "parts", []):
                    parts.append(getattr(p, "text", None))
                cand_dump.append(
                    {
                        "finish_reason": getattr(c, "finish_reason", None),
                        "safety": getattr(c, "safety_ratings", None),
                        "parts": parts,
                    }
                )

            st.write("resp.text (repr):", repr(text))
            st.write("Candidates (raw):")
            st.json(cand_dump)
            results.append((mname, "ok", text))
        except Exception as exc:
            st.write("Exception for model:", mname)
            st.exception(exc)
            results.append((mname, "error", str(exc)))
        time.sleep(0.5)

    st.write("===== SUMMARY =====")
    st.json(
        [
            {
                "model": r[0],
                "status": r[1],
                "text_preview": (r[2][:200] if r[1] == "ok" and r[2] else None),
            }
            for r in results
        ]
    )
    st.stop()
# --- END DEBUG BLOCK ---
